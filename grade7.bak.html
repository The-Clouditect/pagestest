<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reading Comprehension Research Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            height: 100vh;
            overflow: hidden;
        }
        
        .container {
            display: flex;
            height: 100vh;
        }
        
        .pane {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }
        
        .reading-pane {
            background: #f9f9f9;
            border-right: 2px solid #ddd;
        }
        
        .questions-pane {
            background: #fff;
        }
        
        .header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #333;
        }
        
        .student-id-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f0f0f0;
            border-radius: 5px;
        }
        
        .student-id-section input {
            padding: 8px;
            font-size: 16px;
            width: 200px;
            margin-left: 10px;
        }
        
        .passage {
            background: white;
            padding: 25px;
            margin: 20px 0;
            border-radius: 5px;
            line-height: 1.8;
            font-size: 16px;
            cursor: text;
            user-select: text;
            font-family: 'Times New Roman', Times, serif;
        }
        
        .passage h2 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .highlight {
            background-color: #ffeb3b;
            padding: 2px 0;
        }
        
        .highlights-list {
            margin-top: 15px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 5px;
            font-size: 13px;
            max-height: 250px;
            overflow-y: auto;
        }
        
        .highlights-list h3 {
            font-size: 14px;
            margin-bottom: 8px;
            color: #666;
        }
        
        .highlights-list ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .highlights-list li {
            padding: 5px 0;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .highlights-list li:last-child {
            border-bottom: none;
        }
        
        .highlight-text {
            flex: 1;
            padding-right: 10px;
        }
        
        .clear-btn {
            padding: 3px 8px;
            font-size: 11px;
            cursor: pointer;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 3px;
            flex-shrink: 0;
        }
        
        .clear-btn:hover {
            background: #c82333;
        }
        
        .question-set {
            margin-bottom: 40px;
        }
        
        .question-set h2 {
            margin-bottom: 20px;
            color: #333;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        
        .question {
            margin-bottom: 25px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 5px;
        }
        
        .question-text {
            font-weight: 600;
            margin-bottom: 12px;
            font-size: 15px;
        }
        
        .option {
            margin: 8px 0;
            padding: 8px;
        }
        
        .option label {
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        
        .option input[type="radio"] {
            margin-right: 10px;
            cursor: pointer;
        }
        
        .submit-section {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 15px 30px;
            background: #fff;
            border-top: 3px solid #333;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        
        .part-nav-btn {
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            background: #f0f0f0;
            color: #333;
            border: 2px solid #666;
            border-radius: 5px;
        }
        
        .part-nav-btn:hover {
            background: #e0e0e0;
        }
        
        .part-nav-btn.active {
            background: #333;
            color: white;
            border-color: #333;
        }
        
        .submit-section button {
            padding: 12px 40px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            background: #333;
            color: white;
            border: 2px solid #333;
            border-radius: 5px;
        }
        
        .submit-section button:hover:not(:disabled) {
            background: #555;
            border-color: #555;
        }
        
        .submit-section button:disabled {
            background: #ccc;
            border-color: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .part-content {
            display: none;
        }
        
        .part-content.active {
            display: block;
        }
        
        .pane {
            padding-bottom: 100px; /* Space for fixed bottom nav */
        }
        
        .status-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        
        .status-message.success {
            background: #d4edda;
            color: #155724;
            display: block;
        }
        
        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Reading Pane -->
        <div class="pane reading-pane">
            <div class="header">
                <h1>Reading Passages</h1>
                <p style="color: #666; font-size: 14px; margin-top: 10px;">Select text to highlight it</p>
            </div>
            
            <!-- Part 1 Content -->
            <div class="part-content active" id="part1-reading">
                <div class="passage" id="passage1" data-passage="1">
                    <h2>Excerpt from Becoming Kareem: Growing Up On and Oﬀ the Court</h2>
                    <p><em>(1)</em>When I started high school, I was fourteen years old and six foot ten. The scary thing
about being so tall when you’re so young is that people automatically treat you as if you’re
older. Size implies maturity. Yes, I was the size of an adult (actually, bigger than most!), but
I was still just a kid. And acting more like an adult wouldn’t win me any friends. As a card-
carrying Good Boy, I wanted to meet adults’ expectations and get their praise, but as a
Regular Kid, I wanted to be like my peers and get their friendship. . . .</p>
                    <p><em>(2)</em>I walked into school that first day resplendent in my blue blazer and slacks, the
school uniform. We all looked like baby-faced accountants in training. I noticed some of
my old classmates from St. Jude, the ones who had turned their backs on me, and we
continued our policy of actively ignoring one another. I felt the pain of their betrayal, but I
forced my face to remain expressionless. I couldn’t let them see that they had hurt me. I
shoved the pain deep down into the coldest part of my heart. I was here to study hard at
academics and to work hard at basketball under my new coach, Jack Donahue. I was here
to excel. Nothing else mattered.</p>
                    <p><em>(3)</em>I did excel. I made the honor roll my first semester, pleasing my parents and teachers.
Learning came naturally to me. I loved reading, especially about history and adventure
stories like The Theree Musketeers. Basketball, however, I had to work at to do well in. But
the fierce competitor that had been awakened in me loved challenges. . . .</p>  
                    <p><em>(4)</em>My refuge from the explosive turmoil outside, and the implosive turmoil I had
started to feel inside, was basketball. The practices were so exhausting that I barely had
time to think about anything else. Every school day I crawled out of bed early, went to
school, practiced basketball until five o’clock, staggered home, powered through my
homework, zoned out in front of the TV, and went to bed.</p>
                    <p><em>(5)</em>Weekends, I hung out with my only close friend left in the projects, Norbert. We
would shut ourselves in my room to play chess and talk about our plans for the future. He was determined to become a draftsman, making detailed drawings for engineers who were inventing wonderful new machines. I was going to be an architect and create futuristic
buildings like the ones we saw on the TV show The Jetsons.</p>
                    <p><em>(6)</em>Because the civil rights movement was in the news every day, both of us had started
to take an interest in finding out more about our ethnic origins.</p>
                    <p><em>(7)</em>“You know, we invented the yo-yo,” Norbert, who was part Filipino, bragged one day
in my room. . . .</p>
                    <p><em>(8)</em>Then I’d put on the latest jazz album by Sonny Rollins and say, “Yeah, but we invented
that.”</p>
                    <p><em>(9)</em>And back and forth we’d go, trying to one-up the other in a cultural heritage version
of rock, paper, scissors. This kind of competition required that we do research. We even took the subway to the Metropolitan Museum of Art to find out more about Filipino and African cultures. Most important, I had a friend in whom I could confide any thought or feeling, knowing he would never make fun of me.</p>
                    <p><em>(10)</em>The demands of high school cut into the time I could spend with Norbert. I had the
studying part down, but the basketball part was as rocky as ever. As a freshman, my style of play reflected my personality: politely passive. I had some skills, but I didn’t have an aggressive nature. The good players around me knew how to play rough, use their bodies with authority, and power their way to a rebound. I felt like a pinball bouncing oﬀ players rather than making them bounce oﬀ me. I knew I had to toughen up, and I was committed to getting better, but it wasn’t happening fast enough. . . .</p>
                    <p><em>(11)</em>On the morning our varsity team was scheduled to play a preconference game
against Erasmus Hall High School in Brooklyn, Coach Donahue surprised me by taking me into his oﬃce. I figured he was going to discuss his disappointment in my progress as a player, maybe even say something about it all being a big mistake. That I didn’t belong. Instead, he handed me a varsity uniform.</p>
                    <p><em>(12)</em>“You’ll be suiting up against Erasmus today,” he said.</p>
                    <p><em>(13)</em>I just stood there, the folded uniform in my hand. Was this a joke?</p>
                    <p><em>(14)</em>“Don’t you have a class to go to?” he asked. He pretended to be all business, but I
could tell by the slight grin he was enjoying my dumbfounded reaction.</p>
                    <p><em>(15)</em>When I unfolded the jersey, I saw the number 33—the one I had picked in seventh
grade to honor the football player Mel Triplett. Even my fear of playing poorly and letting everyone down couldn’t overcome my pride at walking out of his oﬃce with that uniform. I had no idea that would be the number I would wear for the rest of my basketball career. I hurried away on a mission to tell anyone who would listen that I would be playing varsity that afternoon. All day, as I sat in classes and walked the hallways and ate lunch, I allowed myself to imagine the game and the parts where I scored impossible shots, made incredible passes, snagged rebounds like a machine. Would the team insist on carrying me out of the gym on their shoulders or just award me the game ball?</p>
                    <p><em>(16)</em>Neither. We got slaughtered. Afterward, I sat in the locker room and cried.</p>
                </div>
                
                <div class="highlights-list">
                    <h3>Your Passage 1 Highlights:</h3>
                    <ul id="highlights-passage1"></ul>
                </div>
            </div>
            
            <!-- Part 2 Content -->
            <div class="part-content" id="part2-reading">
                <div class="passage" id="passage2" data-passage="2">
                    <h2>Excerpt from Inevitable and Only</h2>
                    <p><em>(1)</em>When we stopped at the grocery store, Mom said she wanted comfort food,
something warm and filling. I wished I knew how to make vegetarian paella and chocolate-dipped churros, the special treats my abuelita made for us whenever we visited Mom’s parents down in Florida. But that wasn’t what I was craving, anyhow. So I sent Mom to get flour and sugar while Josh and I filled the cart with cottage cheese, eggs, apples, and raisins. Ingredients for Cottage Cheese Contraption—one of the holdovers from our days at Ahimsa House. Everyone took turns cooking, so some nights we had gourmet Indian stir-fry or fancy Italian pasta dishes, and other nights we had unidentifiable casseroles made with cream of mushroom soup from a can.</p>
                    <p><em>(2)</em>Or Cottage Cheese Contraption, invented by an old woman everyone called Granny.
She’d been a housewife in Arkansas for fifty years, and when her husband died, she packed
all her essential belongings into one suitcase, sold everything else, and took oﬀ on a road
trip across the country. A year later, she landed in Takoma Park, at Ahimsa House. She’d
lived there ever since, grandmothering every lost and lonely kid who came through.</p>
                    <p><em>(3)</em>Josh was two when we left Ahimsa House, too young to remember anything about it. But he loved hearing stories about the people who lived there. About the days when Dad was a grad student in Renaissance literature and drama at Georgetown, when Mom served chai lattes at the Sunflower Café and played jazz piano at fancy DC nightclubs on the weekends. I’d shown Josh pictures of Mom in a tiny black dress at one of her gigs, a choker of pearls around her throat. She was unrecognizable, her eyes outlined in smoky makeup, her long hair loose down her back, a white rose tucked behind her ear. . . .</p>
                    <p><em>(4)</em>When Josh was five, he discovered the cello. It happened at the Baltimore Symphony Orchestra. Mom was excited because it was an all-Haydn program—the “Farewell” Symphony and a cello concerto. Mom’s always said, Haydn is the underappreciated Einstein of the music world. Whenever she was upset or stressed in those days, she sat down at the piano and took out her big tattered book of Haydn sonatas, held together with a rubber band, loose pages sticking out everywhere. Now she hardly ever has time to play the piano, and all her music sits neatly stacked in milk crates along the wall.</p>
                    <p><em>(5)</em>I remember the “Farewell” Symphony, how at the end the musicians all got up, one by one, switched oﬀ their stand lights, and walked oﬀ into the wings, until there were just two lonely violinists still playing by themselves. And I remember the cello soloist, his wild curly hair flopping all over the place like a lion’s mane while he played, the way he made the cello sound like it was singing. But mostly I remember Josh, sitting there with his lips parted, as if he were getting ready to take a bite of ice cream but forgot what he was doing and froze in place. When it was over and the cellist took his final bow and left the stage, Josh burst into tears and wailed, “Make the cello man come back!” Mom and Dad were shocked. Josh barely ever complained or whined or asked for anything. The next day, Mom signed him up for cello lessons at the Prep.</p>
                    <p><em>(6)</em>Thinking about all this while I unpacked the Cottage Cheese Contraption ingredients on the kitchen counter, I had an idea. “Josh, why don’t you play me some cooking music?”</p>
                    <p><em>(7)</em>Dad always used to tell me to play “cooking music” on my violin when I wanted to help him with dinner but was too young to be much use. I suspect it was also a sneaky way of getting me to practice, even for only ten or fifteen minutes. I never had the discipline Josh seemed to be born with.</p>
                    <p><em>(8)</em>Josh had wilted a little when we walked into the empty house, but brightened up at my suggestion. He ran upstairs and came down slowly, carrying his cello with both hands, his rock stop1 slung over one shoulder. He settled himself on one of the chairs at the kitchen table and started playing movements from the Bach cello suites from memory.</p>
                    <p><em>(9)</em>I cracked eggs, stirred cottage cheese and flour and sugar together, chopped apples, tossed in raisins, and fried it all into a delicious hot mush, while Josh “talked” to me. that’s how I thought of it—this was Josh’s way of saying the things he didn’t know how to express in words.</p>
                </div>
                
                <div class="highlights-list">
                    <h3>Your Passage 2 Highlights:</h3>
                    <ul id="highlights-passage2"></ul>
                </div>
            </div>
        </div>
        
        <!-- Questions Pane -->
        <div class="pane questions-pane">
            <div class="header">
                <h1>Questions</h1>
            </div>
            
            <div class="student-id-section">
                <label for="studentId"><strong>Student ID:</strong></label>
                <input type="text" id="studentId" placeholder="Enter your ID" required>
            </div>
            
            <!-- Part 1 Questions -->
            <div class="part-content active" id="part1-questions">
                <div class="question-set">
                    <h2>Passage 1 Questions</h2>
                    
                    <div class="question">
                        <div class="question-text">1. What do the details in paragraphs 5 through 9 mainly reveal about Kareem?</div>
                        <div class="option"><label><input type="radio" name="p1q1" value="A"> A. He wishes to visit more museums.</label></div>
                        <div class="option"><label><input type="radio" name="p1q1" value="B"> B. He prefers listening to jazz music.</label></div>
                        <div class="option"><label><input type="radio" name="p1q1" value="C"> C. He enjoys playing competitive games.</label></div>
                        <div class="option"><label><input type="radio" name="p1q1" value="D"> D. He desires to learn more about his heritage.</label></div>
                    </div>
                    
                    <div class="question">
                        <div class="question-text">2. Which quotation best represents the idea that the opinion of classmates can have a major eﬀect
on teenagers?</div>
                        <div class="option"><label><input type="radio" name="p1q2" value="A"> A. “Size implies maturity. Yes, I was the size of an adult (actually, bigger than most!), but I was still just a kid.” (paragraph 1)</label></div>
                        <div class="option"><label><input type="radio" name="p1q2" value="B"> B. “As a card-carrying Good Boy, I wanted to meet adults’ expectations and get their praise, but as a Regular Kid, I wanted to be like my peers and get their friendship. . . .”(paragraph 1)</label></div>
                        <div class="option"><label><input type="radio" name="p1q2" value="C"> C. “Weekends, I hung out with my only close friend left in the projects, Norbert.” (paragraph 5)</label></div>
                        <div class="option"><label><input type="radio" name="p1q2" value="D"> D. “And back and forth we’d go, trying to one-up the other in a cultural heritage version of rock, paper, scissors.” (paragraph 9)</label></div>
                    </div>
                    
                    <div class="question">
                        <div class="question-text">3. Which statement best describes the importance of Norbert in Kareem’s life?</div>
                        <div class="option"><label><input type="radio" name="p1q3" value="A"> A. “We would shut ourselves in my room to play chess and talk about our plans for the future.” (paragraph 5)</label></div>
                        <div class="option"><label><input type="radio" name="p1q3" value="B"> B. “. . . both of us had started to take an interest in finding out more about our ethnic origins.” (paragraph 6)</label></div>
                        <div class="option"><label><input type="radio" name="p1q3" value="C"> C. “And back and forth we’d go, trying to one-up the other in a cultural heritage version of rock, paper, scissors.” (paragraph 9)</label></div>
                        <div class="option"><label><input type="radio" name="p1q3" value="D"> D. “. . . I had a friend in whom I could confide any thought or feeling, knowing he would never make fun of me.” (paragraph 9)</label></div>
                    </div>
                    
                    <div class="question">
                        <div class="question-text">4. In paragraph 10, what does Kareem mean when he says, “I didn’t have an aggressive nature”?</div>
                        <div class="option"><label><input type="radio" name="p1q4" value="A"> A. He believes he needs to change the way he plays basketball.</label></div>
                        <div class="option"><label><input type="radio" name="p1q4" value="B"> B. He understands he may not be a strong player because of his age.</label></div>
                        <div class="option"><label><input type="radio" name="p1q4" value="C"> C. He discovers the other players know more ways to score in basketball.</label></div>
                        <div class="option"><label><input type="radio" name="p1q4" value="D"> D. He realizes he needs to practice more if he wants to improve as a player.</label></div>
                    </div>
                    
                    <div class="question">
                        <div class="question-text">5. What does paragraph 14 show about the relationship between Kareem and Coach Donahue?</div>
                        <div class="option"><label><input type="radio" name="p1q5" value="A"> A. Kareem and Coach Donahue understand the importance of studying.</label></div>
                        <div class="option"><label><input type="radio" name="p1q5" value="B"> B. Kareem is beginning to understand and appreciate Coach Donahue’s personality</label></div>
                        <div class="option"><label><input type="radio" name="p1q5" value="C"> C. Kareem is beginning to understand and dislike Coach Donahue’s personality.</label></div>
                        <div class="option"><label><input type="radio" name="p1q5" value="D"> D. Kareem is worried that Coach Donahue is disappointed by his performance as a player.</label></div>
                    </div>
                    
                    <div class="question">
                        <div class="question-text">6. Which quotation best expresses a central idea in the article?</div>
                        <div class="option"><label><input type="radio" name="p1q6" value="A"> A. "The scary thing about being so tall when you’re so young is that people automatically treat you as if you’re older.” (paragraph 1)</label></div>
                        <div class="option"><label><input type="radio" name="p1q6" value="B"> B. “My refuge from the explosive turmoil outside, and the implosive turmoil I had started to feel inside, was basketball.” (paragraph 4)</label></div>
                        <div class="option"><label><input type="radio" name="p1q6" value="C"> C. “We even took the subway to the Metropolitan Museum of Art to find out more about Filipino and African cultures.” (paragraph 9)</label></div>
                        <div class="option"><label><input type="radio" name="p1q6" value="D"> D. “I hurried away on a mission to tell anyone who would listen that I would be playing varsity that afternoon.” (paragraph 15)</label></div>
                    </div>
                    
                    <div class="question">
                        <div class="question-text">7. How is Kareem and Norbert’s friendship developed in the article?</div>
                        <div class="option"><label><input type="radio" name="p1q7" value="A"> A. The authors describe the various interests that Kareem and Norbert have.</label></div>
                        <div class="option"><label><input type="radio" name="p1q7" value="B"> B. The authors use cause and eﬀect to describe how Kareem and Norbert became friends.</label></div>
                        <div class="option"><label><input type="radio" name="p1q7" value="C"> C. The authors describe the various interests that Kareem and Norbert have.</label></div>
                        <div class="option"><label><input type="radio" name="p1q7" value="D"> D. The authors compare and contrast the friendship of Kareem and Norbert to the friendships of other students.</label></div>
                    </div>
                </div>
            </div>
            
            <!-- Part 2 Questions -->
            <div class="part-content" id="part2-questions">
                <div class="question-set">
                    <h2>Passage 2 Questions</h2>
                    
                    <div class="question">
                        <div class="question-text">8. How does the author best develop the narrator’s point of view in the story?</div>
                        <div class="option"><label><input type="radio" name="p2q1" value="A"> A. by identifying the mother’s opinion about Haydn</label></div>
                        <div class="option"><label><input type="radio" name="p2q1" value="B"> B. by describing the crates where the mother keeps her music</label></div>
                        <div class="option"><label><input type="radio" name="p2q1" value="C"> C. by showing the value of music in the mother’s life</label></div>
                        <div class="option"><label><input type="radio" name="p2q1" value="D"> D. by explaining the importance of the concert for the mother</label></div>
                    </div>
                    
                    <div class="question">
                        <div class="question-text">9. Which quotation shows a change in the direction of the story?</div>
                        <div class="option"><label><input type="radio" name="p2q2" value="A"> A. “. . . she landed in Takoma Park, at Ahimsa House.” (paragraph 2)</label></div>
                        <div class="option"><label><input type="radio" name="p2q2" value="B"> B. “But he loved hearing stories about the people who lived there.” (paragraph 3)</label></div>
                        <div class="option"><label><input type="radio" name="p2q2" value="C"> C. “When Josh was five, he discovered the cello.” (paragraph 4)</label></div>
                        <div class="option"><label><input type="radio" name="p2q2" value="D"> D. “The next day, Mom signed him up for cello lessons . . . ” (paragraph 5)</label></div>
                    </div>
                    
                    <div class="question">
                        <div class="question-text">10. In paragraph 6, how does the narrator’s question to Josh aﬀect the resolution of the story?</div>
                        <div class="option"><label><input type="radio" name="p2q3" value="A"> A. by giving Josh an opportunity to express his feelings</label></div>
                        <div class="option"><label><input type="radio" name="p2q3" value="B"> B. by letting the narrator share a memory with her brother</label></div>
                        <div class="option"><label><input type="radio" name="p2q3" value="C"> C. by revealing how Josh has grown in his ability to play the cello</label></div>
                        <div class="option"><label><input type="radio" name="p2q3" value="D"> D. by allowing the narrator to make dinner while her brother is occupied</label></div>
                    </div>
                    
                    <div class="question">
                        <div class="question-text">11. In paragraph 8, the word “wilted” most likely means that Josh is</div>
                        <div class="option"><label><input type="radio" name="p2q4" value="A"> A. confused</label></div>
                        <div class="option"><label><input type="radio" name="p2q4" value="B"> B. frustrated</label></div>
                        <div class="option"><label><input type="radio" name="p2q4" value="C"> C. sad</label></div>
                        <div class="option"><label><input type="radio" name="p2q4" value="D"> D. tired</label></div>
                    </div>
                    
                    <div class="question">
                        <div class="question-text">12. People often use food as a way to create a sense of community. Which phrase from the story best supports this idea?</div>
                        <div class="option"><label><input type="radio" name="p2q5" value="A"> A. “Everyone took turns cooking” (paragraph 1)</label></div>
                        <div class="option"><label><input type="radio" name="p2q5" value="B"> B. “Cottage Cheese Contraption, invented by an old woman” (paragraph 2)</label></div>
                        <div class="option"><label><input type="radio" name="p2q5" value="C"> C. “when Mom served chai lattes at the Sunflower Café” (paragraph 3)</label></div>
                        <div class="option"><label><input type="radio" name="p2q5" value="D"> D. “fried it all into a delicious hot mush, while Josh ‘talked’ to me” (paragraph 9)</label></div>
                    </div>
                    
                    <div class="question">
                        <div class="question-text">13. In paragraph 9, why is the word “talked” in quotation marks?</div>
                        <div class="option"><label><input type="radio" name="p2q6" value="A"> A. Josh does not wish to have a discussion with the narrator.</label></div>
                        <div class="option"><label><input type="radio" name="p2q6" value="B"> B. Josh communicates with the narrator by using the cello as his voice.</label></div>
                        <div class="option"><label><input type="radio" name="p2q6" value="C"> C. Josh only pretends to communicate with the narrator.</label></div>
                        <div class="option"><label><input type="radio" name="p2q6" value="D"> D. Josh does not want the narrator to share his feelings with their mother.</label></div>
                    </div>
                    
                    <div class="question">
                        <div class="question-text">14. How does the author best develop the narrator’s point of view in the story?</div>
                        <div class="option"><label><input type="radio" name="p2q7" value="A"> A. by sharing the narrator’s memories</label></div>
                        <div class="option"><label><input type="radio" name="p2q7" value="B"> B. by describing the narrator’s opinions</label></div>
                        <div class="option"><label><input type="radio" name="p2q7" value="C"> C. through the narrator’s reactions to events</label></div>
                        <div class="option"><label><input type="radio" name="p2q7" value="D"> D. through the narrator’s dialogue</label></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bottom Navigation with Part buttons and Submit -->
    <div class="submit-section">
        <button class="part-nav-btn active" id="part1Btn">Part 1</button>
        <button class="part-nav-btn" id="part2Btn">Part 2</button>
        <button id="submitBtn">Submit Test</button>
        <div id="statusMessage" class="status-message"></div>
    </div>
    
    <script>
        // Highlight management - track both text and visual elements
        const highlights = {
            passage1: [],
            passage2: []
        };
        
        // Part navigation
        const part1Btn = document.getElementById('part1Btn');
        const part2Btn = document.getElementById('part2Btn');
        const part1Reading = document.getElementById('part1-reading');
        const part2Reading = document.getElementById('part2-reading');
        const part1Questions = document.getElementById('part1-questions');
        const part2Questions = document.getElementById('part2-questions');
        
        part1Btn.addEventListener('click', () => {
            // Show Part 1
            part1Reading.classList.add('active');
            part1Questions.classList.add('active');
            part2Reading.classList.remove('active');
            part2Questions.classList.remove('active');
            
            // Update button states
            part1Btn.classList.add('active');
            part2Btn.classList.remove('active');
        });
        
        part2Btn.addEventListener('click', () => {
            // Show Part 2
            part2Reading.classList.add('active');
            part2Questions.classList.add('active');
            part1Reading.classList.remove('active');
            part1Questions.classList.remove('active');
            
            // Update button states
            part2Btn.classList.add('active');
            part1Btn.classList.remove('active');
        });
        
        // Highlighting functionality
        const passages = document.querySelectorAll('.passage');
        let highlightCounter = 0; // Unique ID for each highlight
        
        passages.forEach(passage => {
            passage.addEventListener('mouseup', function() {
                const selection = window.getSelection();
                let selectedText = selection.toString().trim();
                
                if (selectedText.length > 0) {
                    const passageId = this.id;
                    const range = selection.getRangeAt(0);
                    
                    // ===== PARAGRAPH BOUNDARY TRUNCATION =====
                    const startP = range.startContainer.nodeType === 3 ? 
                        range.startContainer.parentElement.closest('p') : 
                        range.startContainer.closest('p');
                    const endP = range.endContainer.nodeType === 3 ? 
                        range.endContainer.parentElement.closest('p') : 
                        range.endContainer.closest('p');
                    
                    if (startP !== endP) {
                        // console.log('⚠️ Cross-paragraph detected - truncating to paragraph end');
                        range.setEndAfter(startP.lastChild);
                        selectedText = range.toString().trim();
                        // console.log('Truncated text:', selectedText);
                    }
                    // ===== END BOUNDARY TRUNCATION =====
                    
                    highlightCounter++;
                    const highlightId = 'highlight-' + highlightCounter;
                    
                    // ===== DIAGNOSTIC LOGGING: PRE-HIGHLIGHT =====
                    // console.log('═══════════════════════════════════════');
                    // console.log('HIGHLIGHT EVENT START');
                    // console.log('Selected text:', selectedText);
                    // console.log('Text length:', selectedText.length);
                    // console.log('Passage ID:', passageId);
                    // console.log('Current highlights count:', highlights[passageId].length);
                    // console.log('New highlight ID:', highlightId);
                    // console.log('Range details:', {
                    //     startContainer: range.startContainer.nodeName,
                    //     startOffset: range.startOffset,
                    //     endContainer: range.endContainer.nodeName,
                    //     endOffset: range.endOffset,
                    //     collapsed: range.collapsed
                    // });
                    
                    // Check if selection intersects existing highlights
                    // const existingHighlights = this.querySelectorAll('.highlight');
                    // let intersectsHighlight = false;
                    // existingHighlights.forEach(hl => {
                    //     if (range.intersectsNode(hl)) {
                    //         intersectsHighlight = true;
                    //         console.log('⚠️  WARNING: Selection intersects existing highlight:', hl.getAttribute('data-highlight-id'));
                    //     }
                    // });
                    // console.log('Intersects existing highlights:', intersectsHighlight);
                    // console.log('Total existing highlight spans in passage:', existingHighlights.length);
                    // ===== END DIAGNOSTIC LOGGING =====
                    
                    // Visual feedback - highlight the selected text
                    let highlightElements = [];
                    try {
                        const span = document.createElement('span');
                        span.className = 'highlight';
                        span.setAttribute('data-highlight-id', highlightId);
                        
                        // Extract contents, wrap in span, and reinsert
                        const contents = range.extractContents();
                        span.appendChild(contents);
                        range.insertNode(span);
                        
                        highlightElements.push(span);
                        
                        // ===== DIAGNOSTIC LOGGING: POST-HIGHLIGHT =====
                        // console.log('✓ Highlight span created successfully');
                        // console.log('Elements created:', highlightElements.length);
                        // console.log('Span contains nodes:', span.childNodes.length);
                        
                        // Validate DOM structure
                        // const allHighlights = this.querySelectorAll('.highlight');
                        // console.log('Total highlight spans after creation:', allHighlights.length);
                        
                        // Check for nested highlights
                        // let nestedCount = 0;
                        // allHighlights.forEach(hl => {
                        //     const nestedHighlights = hl.querySelectorAll('.highlight');
                        //     if (nestedHighlights.length > 0) {
                        //         nestedCount++;
                        //         console.log('⚠️  NESTED HIGHLIGHT DETECTED in:', hl.getAttribute('data-highlight-id'));
                        //     }
                        // });
                        // if (nestedCount > 0) {
                        //     console.log('⚠️  Total nested highlights:', nestedCount);
                        // }
                        // ===== END DIAGNOSTIC LOGGING =====
                        
                    } catch (e) {
                        // If highlighting fails, still store the text
                        // console.log('❌ Could not apply visual highlight:', e.message);
                        // console.log('Error details:', e);
                    }
                    
                    // Store both the text and reference to visual elements
                    highlights[passageId].push({
                        text: selectedText,
                        id: highlightId,
                        elements: highlightElements
                    });
                    
                    // ===== DIAGNOSTIC LOGGING: ARRAY STATE =====
                    // console.log('Highlights array updated. New length:', highlights[passageId].length);
                    // console.log('All stored highlight IDs:', highlights[passageId].map(h => h.id));
                    // console.log('HIGHLIGHT EVENT END');
                    // console.log('═══════════════════════════════════════\n');
                    // ===== END DIAGNOSTIC LOGGING =====
                    
                    // Update the highlights list display
                    updateHighlightsList(passageId);
                    
                    selection.removeAllRanges();
                }
            });
        });
        
        // Update the highlights list display
        function updateHighlightsList(passageId) {
            const listId = 'highlights-' + passageId;
            const listElement = document.getElementById(listId);
            const highlightArray = highlights[passageId];
            
            listElement.innerHTML = '';
            
            if (highlightArray.length === 0) {
                listElement.innerHTML = '<li style="color: #999; font-style: italic;">No highlights yet</li>';
            } else {
                highlightArray.forEach((highlight, index) => {
                    const li = document.createElement('li');
                    
                    const textSpan = document.createElement('span');
                    textSpan.className = 'highlight-text';
                    textSpan.textContent = `${index + 1}. ${highlight.text}`;
                    
                    const clearBtn = document.createElement('button');
                    clearBtn.className = 'clear-btn';
                    clearBtn.textContent = 'Clear';
                    clearBtn.onclick = function() {
                        // ===== DIAGNOSTIC LOGGING: CLEAR START =====
                        // console.log('───────────────────────────────────────');
                        // console.log('CLEAR EVENT START');
                        // console.log('Passage ID:', passageId);
                        // console.log('Attempting to clear highlight:', highlight.id);
                        // console.log('Display index when clicked:', index);
                        // console.log('Array length before clear:', highlights[passageId].length);
                        // console.log('Current array IDs:', highlights[passageId].map(h => h.id));
                        
                        // Find actual current index by ID
                        const currentIndex = highlights[passageId].findIndex(h => h.id === highlight.id);
                        // console.log('Actual array index for this ID:', currentIndex);
                        
                        if (currentIndex === -1) {
                            // console.log('❌ ERROR: Highlight ID not found in array');
                            // console.log('───────────────────────────────────────\n');
                            return;
                        }
                        
                        const highlightToRemove = highlights[passageId][currentIndex];
                        // console.log('Element count for this highlight:', highlightToRemove.elements.length);
                        
                        // Validate element existence
                        // let validElements = 0;
                        // let invalidElements = 0;
                        // highlightToRemove.elements.forEach(element => {
                        //     if (element && element.parentNode) {
                        //         validElements++;
                        //     } else {
                        //         invalidElements++;
                        //     }
                        // });
                        // console.log('Valid elements:', validElements);
                        // console.log('Invalid/detached elements:', invalidElements);
                        // ===== END DIAGNOSTIC LOGGING =====
                        
                        // Remove visual highlights from the text
                        highlightToRemove.elements.forEach(element => {
                            if (element && element.parentNode) {
                                const parent = element.parentNode;
                                while (element.firstChild) {
                                    parent.insertBefore(element.firstChild, element);
                                }
                                parent.removeChild(element);
                            }
                        });
                        
                        // Remove from the array using current index
                        highlights[passageId].splice(currentIndex, 1);
                        
                        // ===== DIAGNOSTIC LOGGING: CLEAR END =====
                        // console.log('Array length after clear:', highlights[passageId].length);
                        // console.log('Remaining array IDs:', highlights[passageId].map(h => h.id));
                        // console.log('CLEAR EVENT END');
                        // console.log('───────────────────────────────────────\n');
                        // ===== END DIAGNOSTIC LOGGING =====
                        
                        // Refresh the list
                        updateHighlightsList(passageId);
                    };
                    
                    li.appendChild(textSpan);
                    li.appendChild(clearBtn);
                    listElement.appendChild(li);
                });
            }
        }
        
        // Initialize highlight lists as empty
        updateHighlightsList('passage1');
        updateHighlightsList('passage2');
        
        // Dynamically detect all questions from the HTML
        function getAllQuestionNames() {
            const radioInputs = document.querySelectorAll('input[type="radio"]');
            const questionNames = new Set();
            radioInputs.forEach(input => {
                if (input.name) {
                    questionNames.add(input.name);
                }
            });
            return Array.from(questionNames).sort();
        }
        
        // Generate human-readable label from question name (e.g., p1q3 -> Part 1, Question 3)
        function getQuestionLabel(questionName) {
            const match = questionName.match(/p(\d+)q(\d+)/);
            if (match) {
                const partNum = match[1];
                const questionNum = match[2];
                // Calculate overall question number
                const overallNum = partNum === '1' ? parseInt(questionNum) : 7 + parseInt(questionNum);
                return `Part ${partNum}, Question ${overallNum}`;
            }
            return questionName; // Fallback
        }
        
        // CSV generation function
        function escapeCSV(value) {
            if (value === null || value === undefined) return '';
            const stringValue = String(value);
            // If contains comma, quote, or newline, wrap in quotes and escape internal quotes
            if (stringValue.includes(',') || stringValue.includes('"') || stringValue.includes('\n')) {
                return '"' + stringValue.replace(/"/g, '""') + '"';
            }
            return stringValue;
        }
        
        function downloadCSV(studentId, answers, text1Annotations, text2Annotations) {
            // Convert annotation arrays to JSON strings (extract just the text)
            const text1Texts = text1Annotations.map(h => h.text);
            const text2Texts = text2Annotations.map(h => h.text);
            const text1AnnotationsJSON = JSON.stringify(text1Texts);
            const text2AnnotationsJSON = JSON.stringify(text2Texts);
            
            // Get all question names dynamically
            const questionNames = getAllQuestionNames();
            
            // Separate Part 1 and Part 2 questions
            const part1Questions = questionNames.filter(name => name.startsWith('p1'));
            const part2Questions = questionNames.filter(name => name.startsWith('p2'));
            
            // Build data row dynamically
            const row = [
                studentId,
                text1AnnotationsJSON,
                ...part1Questions.map(name => answers[name] || ''),
                text2AnnotationsJSON,
                ...part2Questions.map(name => answers[name] || '')
            ];
            
            // Build CSV content (no header, just data row)
            const csvContent = row.map(escapeCSV).join(',');
            
            // Create blob and download
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `student_${studentId}_${Date.now()}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Submit handler with dynamic validation
        document.getElementById('submitBtn').addEventListener('click', function() {
            const studentId = document.getElementById('studentId').value.trim();
            const statusDiv = document.getElementById('statusMessage');
            
            // Validate student ID
            if (!studentId) {
                statusDiv.className = 'status-message error';
                statusDiv.textContent = 'Error: Please enter your Student ID';
                statusDiv.style.display = 'block';
                return;
            }
            
            // Get all questions dynamically
            const questionNames = getAllQuestionNames();
            
            // Collect and validate answers
            const answers = {};
            let missingQuestions = [];
            
            questionNames.forEach(name => {
                const selected = document.querySelector(`input[name="${name}"]:checked`);
                if (selected) {
                    answers[name] = selected.value;
                } else {
                    answers[name] = '';
                    missingQuestions.push(getQuestionLabel(name));
                }
            });
            
            // Check if any questions are missing
            if (missingQuestions.length > 0) {
                statusDiv.className = 'status-message error';
                if (missingQuestions.length === 1) {
                    statusDiv.textContent = `Error: Please answer ${missingQuestions[0]}`;
                } else if (missingQuestions.length <= 3) {
                    statusDiv.textContent = `Error: Please answer ${missingQuestions.join(', ')}`;
                } else {
                    statusDiv.textContent = `Error: Please answer all questions (${missingQuestions.length} remaining)`;
                }
                statusDiv.style.display = 'block';
                return;
            }
            
            // Disable button during download
            this.disabled = true;
            statusDiv.className = 'status-message';
            statusDiv.textContent = 'Generating CSV...';
            statusDiv.style.display = 'block';
            
            try {
                // Generate and download CSV
                downloadCSV(
                    studentId,
                    answers,
                    highlights.passage1,
                    highlights.passage2
                );
                
                statusDiv.className = 'status-message success';
                statusDiv.textContent = 'CSV file downloaded! Please provide it to your instructor.';
                
                // Re-enable after 3 seconds
                setTimeout(() => {
                    this.disabled = false;
                }, 3000);
                
            } catch (error) {
                statusDiv.className = 'status-message error';
                statusDiv.textContent = 'Download error. Please notify the instructor.';
                this.disabled = false;
            }
        });
    </script>
</body>
</html>